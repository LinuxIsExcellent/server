set(CMAKE_BUILD_TYPE Debug)
set(CMAKE_CXX_FLAGS_DEBUG "-g -Wall -O3 -std=c++11")

include_directories(${DIR_LUA_INCLUDE})

set(LUA_SRC 
3rd/lua/lzio.c
3rd/lua/lbitlib.c
3rd/lua/liolib.c
3rd/lua/ldblib.c
3rd/lua/ldump.c
3rd/lua/llex.c
3rd/lua/lapi.c
3rd/lua/linit.c
3rd/lua/lcorolib.c
3rd/lua/lstrlib.c
3rd/lua/ldebug.c
3rd/lua/lfunc.c
3rd/lua/lctype.c
3rd/lua/lstring.c
3rd/lua/lparser.c
3rd/lua/lmathlib.c
3rd/lua/ltable.c
3rd/lua/lundump.c
3rd/lua/lgc.c
3rd/lua/lvm.c
3rd/lua/ldo.c
3rd/lua/lutf8lib.c
3rd/lua/lcode.c
3rd/lua/ltm.c
3rd/lua/lstate.c
3rd/lua/lauxlib.c
3rd/lua/lmem.c
3rd/lua/ltablib.c
3rd/lua/lbaselib.c
3rd/lua/lopcodes.c
3rd/lua/loslib.c
3rd/lua/lobject.c
3rd/lua/loadlib.c
)

if (${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
    set(CMAKE_MACOSX_RPATH 1)
endif()

add_library(base SHARED
3rd/http_parser/http_parser.c
3rd/tinyxml2.cpp
${LUA_SRC}
graph/vec2.cpp 
event/eventio.cpp
event/dispatcher.cpp
action/executor.cpp 
action/actionbase.cpp 
action/actionmanager.cpp
action/actionnextcall.cpp
action/actiontimeout.cpp
action/actioninterval.cpp
utils/crypto.cpp
utils/random.cpp
utils/utils_string.cpp
utils/utils_time.cpp
utils/file.cpp
thread/task.cpp 
thread/threadpool.cpp
thread/modulethreadpool.cpp 
cli/moduleconsole.cpp
dbo/internal/packet.cpp
dbo/internal/rowreader.cpp
dbo/internal/rowreaderbinary.cpp
dbo/internal/rowreadertext.cpp 
dbo/internal/connectionimpl.cpp
dbo/dbtemplate.cpp 
dbo/metadata.cpp
dbo/statement.cpp
dbo/resultset.cpp 
dbo/preparedstatement.cpp 
dbo/connection.cpp
dbo/moduledbo.cpp
dbo/internal/configure.cpp
dbo/dbpool.cpp 
command/command.cpp
command/runner.cpp
command/runnermgr.cpp
logger.cpp
memory/memorychunk.cpp 
memory/memorypool.cpp
memory/memorypoolmgr.cpp
net/utils.cpp
net/client.cpp
net/listener.cpp
gateway/usersession.cpp
gateway/packet_base.cpp 
gateway/packet.cpp
gateway/packetpipe.cpp 
gateway/websocketframeparser.cpp 
gateway/websocketheadparser.cpp 
gateway/userclient.cpp
gateway/configure.cpp 
gateway/gateway.cpp
cluster/connector.cpp 
cluster/message.cpp
cluster/mailbox.cpp 
cluster/mailboxid.cpp
cluster/modulecluster.cpp
cluster/configure.cpp
cluster/nodemonitor.cpp
cluster/rpcservice.cpp 
cluster/rpcstub.cpp
lua/parser.cpp 
lua/modulelua.cpp
lua/luacallbackmgr.cpp 
lua/luaex.cpp 
lua/luavm.cpp 
lua/luavmpool.cpp 
lua/luamessage.cpp
lua/lua_module_dbo.cpp 
lua/lua_module_timer.cpp 
lua/lua_module_net.cpp
lua/lua_module_utils.cpp 
lua/lua_module_trie.cpp 
lua/lua_module_vm.cpp 
lua/lua_module_http.cpp
lua/lua_module_cluster.cpp 
lua/lua_module_framework.cpp 
rest/configure.cpp 
rest/server.cpp
rest/binaryclient.cpp 
rest/binaryserver.cpp
rest/httpserver.cpp
http/constant.cpp
http/modulehttpclient.cpp 
http/httpclient.cpp
http/hostnameresolver.cpp 
http/urlbuilder.cpp 
http/httpserver.cpp 
http/response.cpp 
http/jsonresponse.cpp 
http/httpacceptor.cpp
trie/trietree.cpp
trie/moduletrietree.cpp 
lang.cpp
configurehelper.cpp
cron/cronjob.cpp
cron/modulecronjob.cpp 
cron/timestruct.cpp 
modulebase.cpp  
framework.cpp
data.cpp 
objectmaintainer.cpp  
object.cpp
exception.cpp 
autoreleasepool.cpp 
)

if (${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
    target_link_libraries(base crypto.a z)
endif()
